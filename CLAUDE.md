# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

- `npm run build`: Compile TypeScript and copy icons to dist/ folder
- `npm run dev`: Watch mode compilation (TypeScript only, no icon copying)
- `npm run lint`: Check code with ESLint using n8n-nodes-base plugin
- `npm run lintfix`: Auto-fix ESLint issues where possible
- `npm run format`: Format code with Prettier
- `npm run prepublishOnly`: Full build + lint check for publishing

## Architecture

This is an n8n community node package for Docutray integration using the n8n nodes API version 1. The package provides two specialized nodes: one for OCR document processing and document type identification, and another for knowledge base search using RAG technology. The project follows n8n's standard node development patterns:

### Project Structure
- `/nodes/` - Contains node implementations (*.node.ts files)
  - `Docutray/` - Document processing node (Convert and Identify operations)
  - `DocutrayKnowledgeBase/` - Knowledge base search node (Search operation)
- `/credentials/` - Contains credential type definitions (*.credentials.ts files)
  - Expected: DocutrayApi credentials for API key authentication (shared between both nodes)
- `/dist/` - Compiled output (generated by build process)
- `gulpfile.js` - Handles icon copying during build

### Node Implementation Pattern
Nodes implement the `INodeType` interface with:
- `description: INodeTypeDescription` - Defines UI, properties, credentials, and API defaults
- **Docutray node**: Resource/Operation pattern (Document resource with Convert/Identify operations)
- **DocutrayKnowledgeBase node**: Direct operation pattern (Search operation only)
- TypeScript compilation to CommonJS modules targeting ES2019

### Docutray API Operations
- **Convert Operation**: OCR text extraction from documents (supports file upload, Base64, and URL input)
- **Identify Operation**: Document type identification with confidence scores
- **Knowledge Base Search Operation**: RAG-based semantic search in knowledge bases

### Credentials Pattern
Credentials implement `ICredentialType` interface with:
- Properties for user input (API key for Docutray authentication)
- `authenticate` object defining how credentials are injected into requests (Bearer token)
- `test` object for credential validation against Docutray API

### Build Process
1. `rimraf dist` - Clean output directory
2. `tsc` - Compile TypeScript files
3. `gulp build:icons` - Copy PNG/SVG files to dist/

### ESLint Configuration
Uses `eslint-plugin-n8n-nodes-base` with community package rules. Configured to ignore JavaScript files and focus on TypeScript sources in nodes/ and credentials/ directories.

## Testing Locally
Install n8n globally (`npm install n8n -g`) and link this package for local testing with n8n's development environment.

## Docutray API Details
- **Base URL**: https://docs.docutray.com/docs/api/
- **Authentication**: Bearer token (API key)
- **Convert Endpoint**: `/convert/post` - OCR text extraction
- **Identify Endpoint**: `/identify/post` - Document type identification
- **Knowledge Base Search Endpoint**: `/knowledge/bases/{id}/search/post` - RAG semantic search
- **Supported formats**: JPEG, PNG, GIF, BMP, WebP, PDF (max 100MB)
- **Input methods**: File upload, Base64 encoding, or image URL