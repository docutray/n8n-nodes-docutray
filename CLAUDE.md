# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

- `npm run build`: Compile TypeScript and copy icons to dist/ folder
- `npm run dev`: Watch mode compilation (TypeScript only, no icon copying)
- `npm run lint`: Check code with ESLint using n8n-nodes-base plugin
- `npm run lintfix`: Auto-fix ESLint issues where possible
- `npm run format`: Format code with Prettier
- `npm run prepublishOnly`: Full build + lint check for publishing

## Architecture

This is an n8n community node package for Docutray integration using the n8n nodes API version 1. The package provides a unified node with resource-based organization for OCR document processing, document type identification, and knowledge base search using RAG technology. The project follows n8n's standard node development patterns:

### Project Structure
- `/nodes/` - Contains node implementations (*.node.ts files)
  - `Docutray/` - Unified node with resource-based organization
    - `Docutray.node.ts` - Main node implementation with resource routing
    - `DocutrayDescription.ts` - Main description combining all resources
    - `DocumentDescription.ts` - Document resource operations (Convert/Identify)
    - `KnowledgeBaseDescription.ts` - Knowledge base resource operations (Search)
- `/credentials/` - Contains credential type definitions (*.credentials.ts files)
  - `DocutrayApi.credentials.ts` - API key authentication (shared across all resources)
- `/dist/` - Compiled output (generated by build process)
- `gulpfile.js` - Handles icon copying during build

### Node Implementation Pattern
The unified node implements the `INodeType` interface with:
- `description: INodeTypeDescription` - Defines UI, properties, credentials, and API defaults
- **Resource/Operation pattern**: Users first select resource (Document/Knowledge Base), then operation
- **Resource routing in execute method**: Handles different resources with appropriate API calls
- **LoadOptions methods**: Dynamic dropdown population for knowledge base selection
- **Modular description files**: Separate files for each resource's operations and fields
- TypeScript compilation to CommonJS modules targeting ES2019

### Docutray API Operations
- **Document Resource**:
  - **Convert Operation**: OCR text extraction from documents (supports file upload, Base64, and URL input)
  - **Identify Operation**: Document type identification with confidence scores
- **Knowledge Base Resource**:
  - **Search Operation**: RAG-based semantic search in knowledge bases with dynamic selector

### Credentials Pattern
Credentials implement `ICredentialType` interface with:
- Properties for user input (API key for Docutray authentication)
- `authenticate` object defining how credentials are injected into requests (Bearer token)
- `test` object for credential validation against Docutray API

### Build Process
1. `rimraf dist` - Clean output directory
2. `tsc` - Compile TypeScript files
3. `gulp build:icons` - Copy PNG/SVG files to dist/

### ESLint Configuration
Uses `eslint-plugin-n8n-nodes-base` with community package rules. Configured to ignore JavaScript files and focus on TypeScript sources in nodes/ and credentials/ directories.

## Testing Locally
Install n8n globally (`npm install n8n -g`) and link this package for local testing with n8n's development environment.

## Docutray API Details
- **Base URL**: https://docs.docutray.com/docs/api/
- **Authentication**: Bearer token (API key)
- **Convert Endpoint**: `/convert/post` - OCR text extraction
- **Identify Endpoint**: `/identify/post` - Document type identification
- **Knowledge Base List Endpoint**: `/knowledge-bases` - List available knowledge bases for dynamic selector
- **Knowledge Base Search Endpoint**: `/knowledge-bases/{id}/search/post` - RAG semantic search
- **Supported formats**: JPEG, PNG, GIF, BMP, WebP, PDF (max 100MB)
- **Input methods**: File upload, Base64 encoding, or image URL
- **Production endpoint**: `https://app.docutray.com/api`